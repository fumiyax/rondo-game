<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é³¥ã‹ã”ãƒã‚¹ã‚¿ãƒ¼ âš½</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Noto+Sans+JP:wght@400;700;900&display=swap');
:root{--neon:#b8ff4e;--red:#ff3b3b;--blue:#3baaff;--white:#f5fff0;--dark:#0a1a0f;--orange:#ff9500;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--dark);font-family:'Noto Sans JP',sans-serif;color:var(--white);min-height:100vh;}
header{text-align:center;padding:10px 10px 3px;}
header h1{font-family:'Orbitron',sans-serif;font-size:clamp(15px,4vw,24px);color:var(--neon);letter-spacing:3px;text-shadow:0 0 18px rgba(184,255,78,0.5);}
header p{font-size:10px;color:rgba(255,255,255,0.4);margin-top:2px;}

/* â”€â”€ TABS â”€â”€ */
.main-tabs{display:flex;justify-content:center;background:rgba(0,0,0,0.5);border-bottom:1px solid rgba(255,255,255,0.08);}
.main-tab{flex:1;max-width:150px;font-family:'Noto Sans JP',sans-serif;font-weight:700;font-size:13px;padding:10px 0;border:none;background:transparent;color:rgba(255,255,255,0.35);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;}
.main-tab.active{color:var(--neon);border-bottom-color:var(--neon);}

/* â”€â”€ SECTION VISIBILITY â”€â”€ */
.section{display:none;}
.section.visible{display:block;}

/* â”€â”€ PLAY SECTION â”€â”€ */
.mode-bar{display:flex;justify-content:center;gap:7px;padding:6px 10px;background:rgba(0,0,0,0.35);}
.mode-btn{font-family:'Orbitron',sans-serif;font-size:10px;padding:5px 12px;border:2px solid rgba(184,255,78,0.3);border-radius:14px;background:transparent;color:rgba(255,255,255,0.4);cursor:pointer;transition:all 0.2s;}
.mode-btn.active{border-color:var(--neon);color:var(--neon);background:rgba(184,255,78,0.09);}
.stats-bar{display:flex;justify-content:center;gap:12px;padding:5px 14px;background:rgba(0,0,0,0.4);border-bottom:1px solid rgba(184,255,78,0.1);}
.stat{text-align:center;}
.stat .lbl{font-size:8px;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:1px;}
.stat .val{font-family:'Orbitron',sans-serif;font-size:16px;color:var(--neon);line-height:1.1;}
.val.red{color:var(--red);}.val.blue{color:var(--blue);}
.timer-wrap{display:flex;align-items:center;gap:5px;}
#timer-bar{width:70px;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;}
#timer-fill{height:100%;background:var(--neon);border-radius:3px;transition:width 0.1s,background 0.3s;width:100%;}
.game-wrapper{display:flex;flex-direction:column;align-items:center;padding:7px;gap:7px;}
#field-container{position:relative;width:100%;max-width:600px;}
#field{width:100%;border-radius:10px;border:2px solid rgba(184,255,78,0.3);box-shadow:0 0 36px rgba(0,100,20,0.5);cursor:pointer;display:block;touch-action:none;}
#coaching-box{width:100%;max-width:600px;background:rgba(0,0,0,0.6);border:1px solid rgba(184,255,78,0.25);border-radius:9px;padding:8px 12px;min-height:44px;transition:border-color 0.3s;}
#coaching-box.good{border-color:var(--neon);}
#coaching-box.bad{border-color:var(--red);}
#coaching-title{font-size:8px;color:rgba(255,255,255,0.25);text-transform:uppercase;letter-spacing:2px;margin-bottom:2px;}
#coaching-msg{font-size:12px;font-weight:700;line-height:1.4;}
.controls{display:flex;gap:7px;flex-wrap:wrap;justify-content:center;max-width:600px;width:100%;}
.ctrl-btn{font-family:'Noto Sans JP',sans-serif;font-weight:700;font-size:11px;padding:7px 14px;border:none;border-radius:6px;cursor:pointer;}
#btn-start{background:var(--neon);color:var(--dark);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;}
#btn-hint{background:rgba(255,255,255,0.1);color:white;border:1px solid rgba(255,255,255,0.2);}
.legend{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;font-size:9px;color:rgba(255,255,255,0.4);max-width:600px;}
.legend-item{display:flex;align-items:center;gap:3px;}
.dot{width:8px;height:8px;border-radius:50%;}
.dot.a{background:var(--blue);}.dot.d{background:var(--red);}.dot.s{background:var(--orange);}

/* â”€â”€ IN-GAME TUTORIAL PANEL â”€â”€ */
#tut-panel{display:none;position:absolute;top:0;left:0;right:0;z-index:50;
  background:linear-gradient(180deg,rgba(4,16,8,0.97),rgba(4,16,8,0.93));
  border-bottom:2px solid var(--neon);border-radius:0 0 10px 10px;}
.tp-head{display:flex;align-items:center;gap:8px;padding:8px 12px 5px;border-bottom:1px solid rgba(255,255,255,0.06);}
.tp-icon{font-size:18px;}
.tp-title-text{font-weight:700;font-size:12px;color:var(--neon);flex:1;}
.tp-close{background:none;border:none;color:rgba(255,255,255,0.35);font-size:18px;cursor:pointer;line-height:1;padding:0 2px;}
.tp-step{padding:6px 12px;border-left:2px solid transparent;opacity:0.4;transition:all 0.25s;}
.tp-step.active{border-left-color:var(--neon);opacity:1;background:rgba(184,255,78,0.03);}
.tp-step.done{border-left-color:rgba(184,255,78,0.3);opacity:0.55;}
.tp-row{display:flex;gap:9px;align-items:flex-start;}
.ts-num{width:18px;height:18px;border-radius:50%;background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.4);font-size:9px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
.tp-step.done .ts-num{background:rgba(184,255,78,0.25);color:var(--neon);}
.tp-step.active .ts-num{background:var(--neon);color:var(--dark);}
.ts-title{font-weight:700;font-size:11px;margin-bottom:2px;}
.ts-desc{font-size:10px;color:rgba(255,255,255,0.6);line-height:1.5;}
.ts-mission{display:inline-block;margin-top:4px;padding:3px 9px;border-radius:5px;font-size:10px;font-weight:700;}
.ts-mission.offense{background:rgba(59,170,255,0.15);color:var(--blue);}
.ts-mission.defense{background:rgba(255,59,59,0.15);color:var(--red);}
.ts-prog{display:flex;align-items:center;gap:5px;margin-top:4px;}
.ts-prog-bar{flex:1;height:4px;background:rgba(255,255,255,0.1);border-radius:2px;overflow:hidden;}
.ts-prog-fill{height:100%;border-radius:2px;transition:width 0.3s;}
.ts-prog-fill.offense{background:var(--blue);}
.ts-prog-fill.defense{background:var(--red);}
.ts-prog-lbl{font-size:9px;color:rgba(255,255,255,0.4);white-space:nowrap;}
.tp-done-area{padding:8px 12px 10px;text-align:center;border-top:1px solid rgba(255,255,255,0.06);}
.tp-done-msg{font-size:12px;font-weight:700;color:var(--neon);margin-bottom:7px;}
.tp-btn-next{background:var(--neon);color:var(--dark);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;padding:7px 18px;border-radius:5px;cursor:pointer;border:none;font-weight:700;}
.tp-btn-free{background:transparent;color:rgba(255,255,255,0.35);font-size:10px;padding:5px 12px;border:1px solid rgba(255,255,255,0.12);border-radius:5px;cursor:pointer;margin-left:5px;}

/* â”€â”€ TUTORIAL LIST SECTION â”€â”€ */
.tut-side-tabs{display:flex;justify-content:center;background:rgba(0,0,0,0.4);border-bottom:1px solid rgba(255,255,255,0.07);}
.tst-btn{flex:1;max-width:130px;font-family:'Noto Sans JP',sans-serif;font-weight:700;font-size:12px;padding:9px 0;border:none;background:transparent;color:rgba(255,255,255,0.35);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;}
.tst-btn.offense.active{color:var(--blue);border-bottom-color:var(--blue);}
.tst-btn.defense.active{color:var(--red);border-bottom-color:var(--red);}
.tut-list{padding:10px;max-width:600px;margin:0 auto;display:flex;flex-direction:column;gap:7px;}
.tlc{background:rgba(0,0,0,0.45);border:1px solid rgba(255,255,255,0.1);border-radius:12px;display:flex;align-items:center;gap:12px;padding:13px 14px;cursor:pointer;transition:all 0.18s;}
.tlc:hover{background:rgba(255,255,255,0.06);border-color:rgba(255,255,255,0.2);}
.tlc.offense{border-left:3px solid var(--blue);}
.tlc.defense{border-left:3px solid var(--red);}
.tlc-icon{font-size:24px;flex-shrink:0;}
.tlc-body{flex:1;}
.tlc-title{font-weight:700;font-size:13px;}
.tlc-sub{font-size:10px;color:rgba(255,255,255,0.45);margin-top:3px;line-height:1.4;}
.tlc-badge{font-size:9px;padding:2px 8px;border-radius:9px;font-weight:700;flex-shrink:0;}
.offense .tlc-badge{background:rgba(59,170,255,0.2);color:var(--blue);}
.defense .tlc-badge{background:rgba(255,59,59,0.2);color:var(--red);}

/* â”€â”€ POPUPS â”€â”€ */
.popup{position:absolute;font-family:'Orbitron',sans-serif;font-size:13px;font-weight:900;pointer-events:none;animation:popFloat 1.1s ease-out forwards;white-space:nowrap;text-shadow:0 2px 8px rgba(0,0,0,0.6);}
@keyframes popFloat{0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-44px) scale(1.15);}}
.through-banner{position:absolute;left:50%;top:38%;transform:translate(-50%,-50%) scale(0.5);background:linear-gradient(135deg,#ffe600,#ff9500);color:#1a1a00;font-family:'Orbitron',sans-serif;font-size:clamp(11px,2.8vw,19px);font-weight:900;padding:6px 18px;border-radius:26px;pointer-events:none;white-space:nowrap;letter-spacing:2px;box-shadow:0 4px 22px rgba(255,180,0,0.7);animation:bannerPop 1.8s ease-out forwards;z-index:10;}
@keyframes bannerPop{0%{opacity:0;transform:translate(-50%,-50%) scale(0.4) rotate(-4deg);}15%{opacity:1;transform:translate(-50%,-50%) scale(1.06) rotate(2deg);}45%{transform:translate(-50%,-50%) scale(1.01);}70%{opacity:1;}100%{opacity:0;transform:translate(-50%,-60%) scale(0.95);}}
.star-p{position:absolute;font-size:15px;pointer-events:none;animation:starFly 1.4s ease-out forwards;}
@keyframes starFly{0%{opacity:1;transform:translate(0,0);}100%{opacity:0;transform:var(--ft);}}
.step-flash{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(184,255,78,0.93);color:var(--dark);font-family:'Orbitron',sans-serif;font-size:clamp(12px,3.5vw,19px);font-weight:900;padding:9px 22px;border-radius:24px;pointer-events:none;animation:flashAnim 1.5s ease-out forwards;z-index:60;white-space:nowrap;}
@keyframes flashAnim{0%{opacity:0;transform:translate(-50%,-50%) scale(0.6);}20%{opacity:1;transform:translate(-50%,-50%) scale(1.04);}70%{opacity:1;}100%{opacity:0;transform:translate(-50%,-62%) scale(1);}}
</style>
</head>
<body>

<header>
  <h1>âš½ é³¥ã‹ã”ãƒã‚¹ã‚¿ãƒ¼</h1>
  <p>ãƒ‘ã‚¹ãƒ»ä½“ã®å‘ããƒ»ãƒ•ã‚©ãƒ­ãƒ¼ã®å‹•ãã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†</p>
</header>

<div class="main-tabs">
  <button class="main-tab active" id="tab-play" onclick="switchTab('play')">âš½ ãƒ—ãƒ¬ã‚¤</button>
  <button class="main-tab" id="tab-tutorial" onclick="switchTab('tutorial')">ğŸ“– ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</button>
</div>

<!-- â•â• PLAY SECTION â•â• -->
<div class="section visible" id="sec-play">
  <div class="mode-bar">
    <button class="mode-btn" id="mode-4v1" onclick="setMode('4v1')">4 vs 1</button>
    <button class="mode-btn active" id="mode-4v2" onclick="setMode('4v2')">4 vs 2</button>
    <button class="mode-btn" id="mode-5v2" onclick="setMode('5v2')">5 vs 2</button>
  </div>
  <div class="stats-bar">
    <div class="stat"><div class="lbl">ãƒ‘ã‚¹æˆåŠŸ</div><div class="val blue" id="stat-pass">0</div></div>
    <div class="stat timer-wrap">
      <div><div class="lbl">æ®‹ã‚Šæ™‚é–“</div><div class="val" id="stat-time">60</div></div>
      <div id="timer-bar"><div id="timer-fill"></div></div>
    </div>
    <div class="stat"><div class="lbl">ã‚«ãƒƒãƒˆ</div><div class="val red" id="stat-cut">0</div></div>
    <div class="stat"><div class="lbl">ãƒ¬ãƒ™ãƒ«</div><div class="val" id="stat-level">1</div></div>
  </div>
  <div class="game-wrapper">
    <div id="field-container">
      <canvas id="field"></canvas>
      <!-- ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ã‚²ãƒ¼ãƒ å†…ãƒ‘ãƒãƒ« -->
      <div id="tut-panel">
        <div class="tp-head">
          <span class="tp-icon" id="tp-icon"></span>
          <span class="tp-title-text" id="tp-title-text"></span>
          <button class="tp-close" onclick="closeTutPanel()">âœ•</button>
        </div>
        <div id="tp-steps-wrap"></div>
        <div class="tp-done-area" id="tp-done-area" style="display:none">
          <div class="tp-done-msg" id="tp-done-msg"></div>
          <button class="tp-btn-next" id="tp-btn-next">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— â†’</button>
          <button class="tp-btn-free" onclick="closeTutPanel()">è‡ªç”±ç·´ç¿’ã¸</button>
        </div>
      </div>
    </div>
    <div id="coaching-box">
      <div id="coaching-title">ã‚³ãƒ¼ãƒãƒ³ã‚°ãƒã‚¤ãƒ³ãƒˆ</div>
      <div id="coaching-msg">ãƒ‘ã‚¹ã—ãŸã„é¸æ‰‹ï¼ˆé’ï¼‰ã‚’ç›´æ¥ã‚¿ãƒƒãƒ—ï¼</div>
    </div>
    <div class="controls">
      <button class="ctrl-btn" id="btn-start">â–¶ å†ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button class="ctrl-btn" id="btn-hint">ğŸ’¡ ãƒ’ãƒ³ãƒˆ</button>
    </div>
    <div class="legend">
      <div class="legend-item"><div class="dot a"></div>æ”»æ’ƒè€…</div>
      <div class="legend-item"><div class="dot d"></div>å®ˆå‚™è€…</div>
      <div class="legend-item"><div class="dot s"></div>ãƒ•ã‚©ãƒ­ãƒ¼ä¸­</div>
    </div>
  </div>
</div>

<!-- â•â• TUTORIAL SECTION â•â• -->
<div class="section" id="sec-tutorial">
  <div class="tut-side-tabs">
    <button class="tst-btn offense active" id="tst-offense" onclick="switchTutSide('offense')">âš”ï¸ æ”»æ’ƒ</button>
    <button class="tst-btn defense" id="tst-defense" onclick="switchTutSide('defense')">ğŸ›¡ï¸ å®ˆå‚™</button>
  </div>
  <div class="tut-list" id="tut-list-offense"></div>
  <div class="tut-list" id="tut-list-defense" style="display:none"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TUTORIAL DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var LESSONS = {
  offense: [
    {
      id:'body_angle', icon:'ğŸ‘€', badge:'åŸºæœ¬', mode:'4v1',
      title:'ä½“ã®å‘ãï¼ˆã‚ªãƒ¼ãƒ—ãƒ³ã§å—ã‘ã‚ˆã†ï¼‰',
      sub:'ãƒ‘ã‚¹ã‚’ã‚‚ã‚‰ã†å‰ã‹ã‚‰2ã¤ã®é¸æŠè‚¢ã‚’æŒã¤',
      steps:[
        { title:'ãªãœä½“ã®å‘ããŒå¤§äº‹ï¼Ÿ',
          desc:'ãƒœãƒ¼ãƒ«ã‚’å—ã‘ã‚‹ã¨ãã€ŒèƒŒä¸­ã‚’å‘ã‘ã¦ã„ã‚‹ï¼ˆCLOSEï¼‰ã€ã¨æ¬¡ã®ãƒ‘ã‚¹ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚\nåŠèº«ï¼ˆOPENï¼‰ã§å—ã‘ã‚Œã°å·¦å³ã©ã¡ã‚‰ã«ã‚‚ç´ æ—©ããƒ‘ã‚¹ã§ãã‚‹ã‚ˆã€‚',
          mission:{ text:'ç·‘ã®çŸ¢å°ï¼ˆOPENï¼‰ã®é¸æ‰‹ã«3å›ãƒ‘ã‚¹ã—ã‚ˆã†', side:'offense', goal:3, event:'open_pass' } },
        { title:'2ã¤ã®ã‚³ãƒ¼ã‚¹ã‚’è¦‹ã¦ã‹ã‚‰å—ã‘ã‚ˆã†',
          desc:'ãƒ‘ã‚¹ã‚’ã‚‚ã‚‰ã†å‰ã«ã€æ¬¡ã«ãƒ‘ã‚¹ã§ãã‚‹å…ˆã‚’2ã¤ç¢ºèªã—ã‚ˆã†ã€‚\nå—ã‘ãŸç¬é–“ã«è¿·ã‚ãªãã¦æ¸ˆã‚€ï¼',
          mission:{ text:'OPENã®é¸æ‰‹ã¸ã®é€£ç¶šãƒ‘ã‚¹ã‚’5å›æˆåŠŸã•ã›ã‚ˆã†', side:'offense', goal:5, event:'open_pass' } },
        { title:'ã¾ã¨ã‚ï¼šç·‘ã®çŸ¢å°ã‚’å„ªå…ˆã—ã‚ˆã†',
          desc:'ãƒ»ãƒœãƒ¼ãƒ«ãŒæ¥ã‚‹å‰ã«ä½“ã‚’ã²ã‚‰ã\nãƒ»ç·‘ã®çŸ¢å° = 2ã‚³ãƒ¼ã‚¹è¦‹ãˆã¦ã‚‹ = é€Ÿã„ãƒ—ãƒ¬ãƒ¼\nãƒ»èµ¤ã®çŸ¢å° = èƒŒä¸­å‘ã = é…ã„ãƒ—ãƒ¬ãƒ¼',
          mission:{ text:'10æœ¬ãƒ‘ã‚¹ã‚’ç¹‹ã’ã¦ã¿ã‚ˆã†ï¼', side:'offense', goal:10, event:'any_pass' } }
      ]
    },
    {
      id:'pass_course', icon:'ğŸ”º', badge:'åŸºæœ¬', mode:'4v2',
      title:'ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ã‚’è¤‡æ•°ã¤ãã‚‹ï¼ˆä¸‰è§’å½¢ï¼‰',
      sub:'å¸¸ã«2ã€œ3ã®é¸æŠè‚¢ã‚’ä½œã‚‹ã“ã¨ãŒé³¥ã‹ã”ã®åŸºæœ¬',
      steps:[
        { title:'ä¸‰è§’å½¢ã§ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ã‚’ä½œã‚ã†',
          desc:'ãƒœãƒ¼ãƒ«ã‚’æŒã£ã¦ã„ã‚‹é¸æ‰‹ã‚’é ‚ç‚¹ã«ã—ã¦ã€ä»²é–“ãŒä¸‰è§’å½¢ã®ä½ç½®ã«ç«‹ã¤ã¨2ã‚³ãƒ¼ã‚¹ã§ãã‚‹ã€‚\nç·‘ã®ç‚¹ç·šãŒ2æœ¬ä»¥ä¸Šã‚ã‚Œã°ç†æƒ³çš„ï¼',
          mission:{ text:'ç·‘ã®ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ãŒ2æœ¬ã‚ã‚‹çŠ¶æ…‹ã§ãƒ‘ã‚¹ã—ã‚ˆã†ï¼ˆ3å›ï¼‰', side:'offense', goal:3, event:'multi_open_pass' } },
        { title:'Dã®é–“ã‚’é€šã™ãƒ‘ã‚¹',
          desc:'D2äººã®é–“ã«ãƒ‘ã‚¹ãŒé€šã‚‹ã¨ã€ãƒãƒ£ãƒ¬ãƒ³ã‚¸&ã‚«ãƒãƒ¼ã®éšŠå½¢ãŒå´©ã‚Œã‚‹ã€‚\nç©æ¥µçš„ã«ç‹™ã£ã¦ã¿ã‚ˆã†ï¼',
          mission:{ text:'Dã®é–“ã‚’é€šã™ã‚¹ãƒ«ãƒ¼ãƒ‘ã‚¹ã‚’1å›æˆåŠŸã•ã›ã‚ˆã†', side:'offense', goal:1, event:'through_pass' } },
        { title:'ä¸€ç›´ç·šã¯NG',
          desc:'ä»²é–“ãŒä¸€ç›´ç·šã«ä¸¦ã¶ã¨1äººã®Dã§2ã‚³ãƒ¼ã‚¹å¡ã’ã¦ã—ã¾ã†ã€‚\nä¸‰è§’å½¢ãƒ»æ–œã‚ã®é–¢ä¿‚ã‚’æ„è­˜ã—ã‚ˆã†ã€‚',
          mission:{ text:'ã‚«ãƒƒãƒˆã•ã‚Œãšã«8æœ¬ãƒ‘ã‚¹ã‚’ç¹‹ã”ã†', side:'offense', goal:8, event:'no_cut_pass' } }
      ]
    },
    {
      id:'follow', icon:'ğŸŸ ', badge:'å¿œç”¨', mode:'4v2',
      title:'ãƒ•ã‚©ãƒ­ãƒ¼ã®å‹•ãï¼ˆå‘³æ–¹ã‚’åŠ©ã‘ã‚ˆã†ï¼‰',
      sub:'å›°ã£ã¦ã„ã‚‹ä»²é–“ã®ãã°ã«å‹•ã„ã¦ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ã‚’ã¤ãã‚‹',
      steps:[
        { title:'ãƒ•ã‚©ãƒ­ãƒ¼ãŒå¿…è¦ãªå ´é¢',
          desc:'Dã«è¿½ã„è¾¼ã¾ã‚Œã¦ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ãŒãªããªã£ãŸã¨ãã€éš£ã®ä»²é–“ãŒå‹•ã„ã¦ã‚³ãƒ¼ã‚¹ã‚’ä½œã£ã¦ãã‚Œã‚‹ã€‚\nã‚ªãƒ¬ãƒ³ã‚¸ã®ã€ŒRUNï¼ã€ãŒå‹•ã„ãŸã‚‰ãƒãƒ£ãƒ³ã‚¹ï¼',
          mission:{ text:'ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ã®ä»²é–“ã«ãƒ‘ã‚¹ã—ã‚ˆã†ï¼ˆ2å›ï¼‰', side:'offense', goal:2, event:'pass_to_follow' } },
        { title:'ãƒ•ã‚©ãƒ­ãƒ¼å¾Œã¯ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹',
          desc:'ãƒ‘ã‚¹ãŒé€šã£ãŸã‚ã¨ã¯ãƒ•ã‚©ãƒ­ãƒ¼ã—ãŸé¸æ‰‹ãŒå…ƒã®ãƒã‚¸ã‚·ãƒ§ãƒ³ã«æˆ»ã‚‹ã€‚\nå››è§’å½¢ã®å½¢ã‚’ä¿ã¤ã“ã¨ã§æ¬¡ã®ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ãŒå¸¸ã«ã‚ã‚‹çŠ¶æ…‹ã«ãªã‚‹ã‚ˆã€‚',
          mission:{ text:'ãƒ•ã‚©ãƒ­ãƒ¼è¾¼ã¿ã§10æœ¬ãƒ‘ã‚¹ã‚’ç¹‹ã”ã†', side:'offense', goal:10, event:'any_pass' } }
      ]
    }
  ],
  defense: [
    {
      id:'challenge_cover', icon:'ğŸ›¡ï¸', badge:'åŸºæœ¬', mode:'4v2',
      title:'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼†ã‚«ãƒãƒ¼',
      sub:'2äººã§é€£æºã—ã¦å®ˆã‚‹ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ã®åŸºæœ¬',
      steps:[
        { title:'C1ï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼ï¼‰ã®å½¹å‰²',
          desc:'C1ã¯ç›´ç·šçš„ã«çªã£è¾¼ã¾ãªã„ã€‚\nç›¸æ‰‹ã®é¸æŠè‚¢ã‚’åˆ¶é™ã—ãªãŒã‚‰æ–œã‚ã‹ã‚‰å¯„ã›ã‚‹ã€‚\nèµ¤ã„æ‰‡å½¢ãŒC1ã®ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã‚¾ãƒ¼ãƒ³ã€‚ã‚³ãƒ¼ã‚¹ã‚’çµã£ã¦ã„ã‚‹ã®ã‚’ç¢ºèªã—ã‚ˆã†ã€‚',
          mission:{ text:'ã‚²ãƒ¼ãƒ ã‚’è¦³å¯Ÿã—ã¦ãƒ‘ã‚¹ã‚’5æœ¬è¦‹ã‚ˆã†ï¼ˆC1ã®å‹•ãã‚’ãƒã‚§ãƒƒã‚¯ï¼‰', side:'defense', goal:5, event:'any_pass' } },
        { title:'C2ï¼ˆã‚«ãƒãƒ¼ï¼‰ã®å½¹å‰²',
          desc:'C2ã¯C1ãŒå¡ã’ãªã„ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ã‚’ã‚«ãƒãƒ¼ã™ã‚‹ã€‚\nC1ã¨C2ã§ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ã‚’åˆ†æ‹…ã—ã¦å®ˆã£ã¦ã„ã‚‹ã®ãŒç”»é¢ã§ç¢ºèªã§ãã‚‹ã€‚',
          mission:{ text:'D2äººã§ãƒ‘ã‚¹ã‚’ã‚«ãƒƒãƒˆã—ã‚ˆã†ï¼ˆ1å›ï¼‰', side:'defense', goal:1, event:'cut' } },
        { title:'é€£ä¿‚ã—ã¦è¿½ã„è¾¼ã‚‚ã†',
          desc:'C1ãŒå¯„ã›ã¦C2ãŒã‚«ãƒãƒ¼ â†’ æ”»æ’ƒå´ã®é¸æŠè‚¢ãŒæ¸›ã‚‹ã€‚\n2äººãŒé€£å‹•ã™ã‚‹ã¨ã€ã‚¹ãƒ«ãƒ¼ãƒ‘ã‚¹ã‚‚é€šã—ã«ãããªã‚‹ã€‚',
          mission:{ text:'ãƒ‘ã‚¹ã‚’3å›ã‚«ãƒƒãƒˆã—ã‚ˆã†', side:'defense', goal:3, event:'cut' } }
      ]
    },
    {
      id:'intercept', icon:'âš¡', badge:'å¿œç”¨', mode:'4v2',
      title:'ãƒ‘ã‚¹ã‚«ãƒƒãƒˆï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆï¼‰',
      sub:'ãƒ‘ã‚¹ã®çµŒè·¯ã«å…ˆã«å…¥ã£ã¦ãƒœãƒ¼ãƒ«ã‚’å¥ªã†',
      steps:[
        { title:'ã‚«ãƒƒãƒˆã§ãã‚‹çŠ¶æ³ã‚’è¦‹æ¥µã‚ã‚‹',
          desc:'èµ¤ã„ç‚¹ç·šã®ãƒ‘ã‚¹ã‚³ãƒ¼ã‚¹ = DãŒã™ã§ã«é‚ªé­”ã‚’ã—ã¦ã„ã‚‹ã€‚\nDãŒãƒ‘ã‚¹ãƒ©ã‚¤ãƒ³ã«ç«‹ã¦ã¦ã„ã‚‹ã¨ãã€ç›¸æ‰‹ãŒãã®ã‚³ãƒ¼ã‚¹ã«å‡ºã—ãŸã‚‰å¥ªãˆã‚‹ï¼',
          mission:{ text:'ãƒ‘ã‚¹ã‚’ã‚«ãƒƒãƒˆã—ã‚ˆã†ï¼ˆ1å›ï¼‰', side:'defense', goal:1, event:'cut' } },
        { title:'ã‚«ãƒãƒ¼ãŒã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã‚’ç‹™ã†',
          desc:'C1ãŒå¯„ã›ã‚‹ã¨ã€ç›¸æ‰‹ã¯C2ãŒå®ˆã£ã¦ã„ã‚‹ã‚³ãƒ¼ã‚¹ã«ãƒ‘ã‚¹ã—ãŒã¡ã€‚\nC2ãŒãƒ‘ã‚¹ãƒ©ã‚¤ãƒ³ä¸Šã«ç«‹ã¦ã¦ã„ã‚Œã°ã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã®ãƒãƒ£ãƒ³ã‚¹ï¼',
          mission:{ text:'åˆè¨ˆ3å›ã‚«ãƒƒãƒˆã—ã‚ˆã†', side:'defense', goal:3, event:'cut' } }
      ]
    },
    {
      id:'transition', icon:'ğŸ”„', badge:'å¿œç”¨', mode:'4v2',
      title:'æ”»å®ˆã®åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ï¼‰',
      sub:'å¥ªã£ãŸã‚‰å³ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã€å¥ªã‚ã‚ŒãŸã‚‰å³ãƒ—ãƒ¬ã‚¹',
      steps:[
        { title:'å®ˆâ†’æ”»ï¼šå¥ªã£ãŸã‚‰ç´ æ—©ã',
          desc:'ãƒœãƒ¼ãƒ«ã‚’å¥ªã£ãŸã‚‰ï¼ˆã‚«ãƒƒãƒˆã—ãŸã‚‰ï¼‰ã™ãã«ãƒ‘ã‚¹ã‚’ã¤ãªã”ã†ã€‚\nDFãŒå‰ã«å‡ºã¦ã„ã‚‹ã‚¹ã‚­ã«ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã§ãã‚‹ï¼',
          mission:{ text:'ã‚«ãƒƒãƒˆå¾Œã®ã‚²ãƒ¼ãƒ ã§ãƒ‘ã‚¹ã‚’5æœ¬ç¹‹ã’ã‚ˆã†', side:'defense', goal:5, event:'any_pass' } },
        { title:'æ”»â†’å®ˆï¼šå–ã‚‰ã‚ŒãŸã‚‰ã™ããƒ—ãƒ¬ã‚¹',
          desc:'ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã•ã‚ŒãŸã‚‰ã€ãã®ç¬é–“ã«2äººã§ãƒ—ãƒ¬ã‚¹ã‚’ã‹ã‘ã‚‹ã€‚\nC1ã¨C2ãŒã™ãã«å‹•ãå‡ºã™ç”»é¢ã‚’è¦³å¯Ÿã—ã‚ˆã†ã€‚',
          mission:{ text:'åˆè¨ˆ5å›ã‚«ãƒƒãƒˆã—ã‚ˆã†', side:'defense', goal:5, event:'cut' } }
      ]
    }
  ]
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB SWITCHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var currentTab = 'play';

function switchTab(tab) {
  currentTab = tab;
  document.getElementById('tab-play').classList.toggle('active', tab === 'play');
  document.getElementById('tab-tutorial').classList.toggle('active', tab === 'tutorial');
  document.getElementById('sec-play').classList.toggle('visible', tab === 'play');
  document.getElementById('sec-tutorial').classList.toggle('visible', tab === 'tutorial');
  // canvasã®ãƒªã‚µã‚¤ã‚ºï¼ˆplayè¡¨ç¤ºæ™‚ï¼‰
  if (tab === 'play') {
    setTimeout(function(){ resize(); draw(); }, 10);
  }
}

function switchTutSide(side) {
  document.getElementById('tst-offense').classList.toggle('active', side === 'offense');
  document.getElementById('tst-defense').classList.toggle('active', side === 'defense');
  document.getElementById('tut-list-offense').style.display = side === 'offense' ? '' : 'none';
  document.getElementById('tut-list-defense').style.display = side === 'defense' ? '' : 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TUTORIAL LIST RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLessons() {
  ['offense', 'defense'].forEach(function(side) {
    var list = document.getElementById('tut-list-' + side);
    list.innerHTML = '';
    LESSONS[side].forEach(function(lesson, idx) {
      var div = document.createElement('div');
      div.className = 'tlc ' + side;
      div.innerHTML =
        '<span class="tlc-icon">' + lesson.icon + '</span>' +
        '<div class="tlc-body">' +
          '<div class="tlc-title">' + lesson.title + '</div>' +
          '<div class="tlc-sub">' + lesson.sub + '</div>' +
        '</div>' +
        '<span class="tlc-badge">' + lesson.badge + '</span>';
      (function(s, i) {
        div.onclick = function() { startLesson(s, i); };
      })(side, idx);
      list.appendChild(div);
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TUTORIAL STATE & PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var tutState = { active: false };

function startLesson(side, idx) {
  var lesson = LESSONS[side][idx];
  tutState = { active: true, side: side, lessonIdx: idx, stepIdx: 0, progress: 0, lesson: lesson };

  // ãƒ¢ãƒ¼ãƒ‰è¨­å®š
  gameMode = lesson.mode;
  ['4v1','4v2','5v2'].forEach(function(k) {
    document.getElementById('mode-' + k).classList.toggle('active', k === gameMode);
  });

  // ãƒ—ãƒ¬ã‚¤ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆã¦ã‹ã‚‰ã‚²ãƒ¼ãƒ é–‹å§‹
  switchTab('play');
  setTimeout(function() {
    restartGame();
    renderTutPanel();
  }, 60);
}

function renderTutPanel() {
  if (!tutState.active) return;
  var lesson = tutState.lesson;
  var stepIdx = tutState.stepIdx;
  var side = tutState.side;

  document.getElementById('tp-icon').textContent = lesson.icon;
  document.getElementById('tp-title-text').textContent = lesson.title;
  document.getElementById('tp-done-area').style.display = 'none';

  var wr